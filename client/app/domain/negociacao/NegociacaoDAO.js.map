{"version":3,"sources":["../../../app-src/domain/negociacao/NegociacaoDAO.js"],"names":["Negociacao","NegociacaoDAO","constructor","connection","_connection","_store","adiciona","negociacao","Promise","resolve","reject","request","transaction","objectStore","add","onsuccess","e","onerror","console","log","target","error","listaTodos","negociacoes","cursor","openCursor","atual","result","value","_data","_quantidade","_valor","push","continue","apagaTodos","clear"],"mappings":";;;;;;AAASA,gB,iBAAAA,U;;;AAEF,YAAMC,aAAN,CAAoB;AACzBC,oBAAYC,UAAZ,EAAwB;AACtB,eAAKC,WAAL,GAAmBD,UAAnB;AACA,eAAKE,MAAL,GAAc,aAAd;AACD;;AAEDC,iBAASC,UAAT,EAAqB;AACnB,iBAAO,IAAIC,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACtC;AACA,kBAAMC,UAAU,KAAKP,WAAL,CACbQ,WADa,CACD,CAAC,KAAKP,MAAN,CADC,EACc,WADd,EAEbQ,WAFa,CAED,KAAKR,MAFJ,EAGbS,GAHa,CAGTP,UAHS,CAAhB;;AAKAI,oBAAQI,SAAR,GAAoBC,KAAKP,SAAzB;AACAE,oBAAQM,OAAR,GAAkBD,KAAK;AACrBE,sBAAQC,GAAR,CAAYH,EAAEI,MAAF,CAASC,KAArB;AACAX,qBAAO,sCAAP;AACD,aAHD;AAID,WAZM,CAAP;AAaD;;AAEDY,qBAAa;AACX,iBAAO,IAAId,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACtC;;AAEA,kBAAMa,cAAc,EAApB;;AAEA,kBAAMC,SAAS,KAAKpB,WAAL,CACZQ,WADY,CACA,CAAC,KAAKP,MAAN,CADA,EACe,WADf,EAEZQ,WAFY,CAEA,KAAKR,MAFL,EAGZoB,UAHY,EAAf;;AAKAD,mBAAOT,SAAP,GAAmBC,KAAK;AACtB,oBAAMU,QAAQV,EAAEI,MAAF,CAASO,MAAvB;;AAEA,kBAAID,KAAJ,EAAW;AACT,sBAAMnB,aAAa,IAAIP,UAAJ,CACjB0B,MAAME,KAAN,CAAYC,KADK,EAEjBH,MAAME,KAAN,CAAYE,WAFK,EAGjBJ,MAAME,KAAN,CAAYG,MAHK,CAAnB;;AAMAR,4BAAYS,IAAZ,CAAiBzB,UAAjB;AACAmB,sBAAMO,QAAN;AACD,eATD,MASO;AACLxB,wBAAQc,WAAR;AACD;AACF,aAfD;;AAiBAC,mBAAOP,OAAP,GAAiBD,KAAK;AACpBE,sBAAQC,GAAR,CAAYH,EAAEI,MAAF,CAASC,KAArB;AACAX,qBAAO,yCAAP;AACD,aAHD;AAID,WA/BM,CAAP;AAgCD;;AAEDwB,qBAAa;;AAEX,iBAAO,IAAI1B,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;;AAEpC,kBAAMC,UAAU,KAAKP,WAAL,CACXQ,WADW,CACC,CAAC,KAAKP,MAAN,CADD,EACgB,WADhB,EAEXQ,WAFW,CAEC,KAAKR,MAFN,EAGX8B,KAHW,EAAhB;;AAKAxB,oBAAQI,SAAR,GAAoBC,KAAKP,SAAzB;;AAEAE,oBAAQM,OAAR,GAAkBD,KAAK;;AAEnBE,sBAAQC,GAAR,CAAYH,EAAEI,MAAF,CAASC,KAArB;AACAX,qBAAO,yCAAP;AACH,aAJD;AAKH,WAdM,CAAP;AAeD;AA1EwB","file":"NegociacaoDAO.js","sourcesContent":["import { Negociacao } from './Negociacao.js';\r\n\r\nexport class NegociacaoDAO {\r\n  constructor(connection) {\r\n    this._connection = connection;\r\n    this._store = \"negociacoes\";\r\n  }\r\n\r\n  adiciona(negociacao) {\r\n    return new Promise((resolve, reject) => {\r\n      // lideremos com a inserção de dados aqui\r\n      const request = this._connection\r\n        .transaction([this._store], \"readwrite\")\r\n        .objectStore(this._store)\r\n        .add(negociacao);\r\n\r\n      request.onsuccess = e => resolve();\r\n      request.onerror = e => {\r\n        console.log(e.target.error);\r\n        reject(\"Não foi possível salvar a negociação\");\r\n      };\r\n    });\r\n  }\r\n\r\n  listaTodos() {\r\n    return new Promise((resolve, reject) => {\r\n      // lideremos com o cursor aqui\r\n\r\n      const negociacoes = [];\r\n\r\n      const cursor = this._connection\r\n        .transaction([this._store], \"readwrite\")\r\n        .objectStore(this._store)\r\n        .openCursor();\r\n\r\n      cursor.onsuccess = e => {\r\n        const atual = e.target.result;\r\n\r\n        if (atual) {\r\n          const negociacao = new Negociacao(\r\n            atual.value._data,\r\n            atual.value._quantidade,\r\n            atual.value._valor\r\n          );\r\n\r\n          negociacoes.push(negociacao);\r\n          atual.continue();\r\n        } else {\r\n          resolve(negociacoes);\r\n        }\r\n      };\r\n\r\n      cursor.onerror = e => {\r\n        console.log(e.target.error);\r\n        reject(\"Não foi possível listar as negociações.\");\r\n      };\r\n    });\r\n  }\r\n\r\n  apagaTodos() {\r\n\r\n    return new Promise((resolve, reject) => {\r\n\r\n        const request = this._connection\r\n            .transaction([this._store], 'readwrite')\r\n            .objectStore(this._store)\r\n            .clear();\r\n        \r\n        request.onsuccess = e => resolve();\r\n\r\n        request.onerror = e => {\r\n\r\n            console.log(e.target.error);\r\n            reject('Não foi possível apagar as negociações.');\r\n        }\r\n    });\r\n  }\r\n}\r\n"]}