{"version":3,"sources":["../../app-src/controllers/NegociacaoController.js"],"names":["Negociacoes","NegociacaoService","Negociacao","NegociacoesView","MensagemView","Mensagem","DataInvalidaException","DateConverter","getNegociacaoDAO","Bind","NegociacaoController","constructor","$","document","querySelector","bind","_inputQuantidade","_inputData","_inputValor","_negociacoes","_negociacoesView","update","_mensagem","_mensagemView","_service","_init","dao","negociacoes","listaTodos","forEach","adiciona","negociacao","err","texto","message","event","preventDefault","_criaNegociacao","_limpaFormulario","importaNegociacoes","obterNegociacoesDoPeriodo","console","log","filter","paraArray","some","novaNegociacao","equals","negociacaoExistente","value","focus","paraData","parseInt","parseFloat","apaga","apagaTodos","esvazia"],"mappings":"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","file":"NegociacaoController.js","sourcesContent":["import { Negociacoes, NegociacaoService, Negociacao } from \"../domain/index.js\";\r\nimport {\r\n  NegociacoesView,\r\n  MensagemView,\r\n  Mensagem,\r\n  DataInvalidaException,\r\n  DateConverter\r\n} from \"../UI/index.js\";\r\nimport { getNegociacaoDAO, Bind } from \"../util/index.js\";\r\n\r\n// exporta a classe NegociacaoController para quem precisar importar\r\nexport class NegociacaoController {\r\n  constructor() {\r\n    const $ = document.querySelector.bind(document);\r\n\r\n    this._inputQuantidade = $(\"#quantidade\");\r\n    this._inputData = $(\"#data\");\r\n    this._inputValor = $(\"#valor\");\r\n\r\n    // Através de Bind , passamos a instância do modelo, a instância\r\n    // da View e as propriedades ou métodos que desejamos ativar a\r\n    // atualização automática.\r\n    this._negociacoes = new Bind(\r\n      new Negociacoes(),\r\n      new NegociacoesView(\"#negociacoes\"),\r\n      // Não passamos mais os parâmetros de armadilha\r\n      // Dentro de um array\r\n      \"adiciona\",\r\n      \"esvazia\"\r\n    );\r\n\r\n    this._negociacoesView = new NegociacoesView(\"#negociacoes\");\r\n\r\n    // Recebe inicialmente o modelo que encapsula uma lista vazia\r\n    // Chamando o Update\r\n    this._negociacoesView.update(this._negociacoes);\r\n\r\n    this._mensagem = new Bind(\r\n      new Mensagem(),\r\n      new MensagemView(\"#mensagemView\"),\r\n      // Não passamos mais os parâmetros de armadilha\r\n      // Dentro de um array\r\n      \"texto\"\r\n    );\r\n    // Instância da View de mensagens\r\n    this._mensagemView = new MensagemView(\"#mensagemView\");\r\n    // Chamando o Update\r\n    this._mensagemView.update(this._mensagem);\r\n\r\n    this._service = new NegociacaoService();\r\n\r\n    this._init();\r\n  }\r\n\r\n  async _init() {\r\n    try {\r\n      const dao = await getNegociacaoDAO();\r\n      const negociacoes = await dao.listaTodos();\r\n      negociacoes.forEach(negociacao => this._negociacoes.adiciona(negociacao));\r\n    } catch (err) {\r\n      // err.message extrai apenas a mensagem de erro da exceção\r\n\r\n      this._mensagem.texto = err.message;\r\n    }\r\n    // getNegociacaoDAO()\r\n    // .then(dao => dao.listaTodos())\r\n    // .then(negociacoes =>\r\n    //     negociacoes.forEach(negociacao =>\r\n    //         this._negociacoes.adiciona(negociacao)))\r\n    // .catch(err => this._mensagem.texto = err);\r\n  }\r\n\r\n  async adiciona(event) {\r\n    // Cancela a submissão do formulário\r\n\r\n    try {\r\n      event.preventDefault();\r\n      const negociacao = this._criaNegociacao();\r\n\r\n      const dao = await getNegociacaoDAO();\r\n      await dao.adiciona(negociacao);\r\n      this._negociacoes.adiciona(negociacao);\r\n      this._mensagem.texto = \"Negociação adicionada com sucesso!\";\r\n\r\n      this._limpaFormulario();\r\n    } catch (err) {\r\n      this._mensagem.texto = err.message;\r\n    }\r\n  }\r\n\r\n  async importaNegociacoes() {\r\n    try {\r\n      const negociacoes = await this._service.obterNegociacoesDoPeriodo();\r\n      console.log(negociacoes);\r\n      negociacoes.filter(novaNegociacao => \r\n        !this._negociacoes.paraArray().some(negociacaoExistente =>\r\n          novaNegociacao.equals(negociacaoExistente)))\r\n          .forEach(negociacao => this._negociacoes.adiciona(negociacao));\r\n      this._mensagem.texto = 'Negociações do período importadas com sucesso!';\r\n    } catch(err) {\r\n      this._mensagem.texto = err.message;\r\n    }\r\n  }\r\n\r\n  _limpaFormulario() {\r\n    this._inputData.value = \"\";\r\n    this._inputQuantidade.value = 1;\r\n    this._inputValor.value = 0.0;\r\n    this._inputData.focus();\r\n  }\r\n\r\n  _criaNegociacao() {\r\n    return new Negociacao(\r\n      DateConverter.paraData(this._inputData.value),\r\n      parseInt(this._inputQuantidade.value),\r\n      parseFloat(this._inputValor.value)\r\n    );\r\n  }\r\n\r\n  async apaga() {\r\n    try {\r\n      const dao = await getNegociacaoDAO();\r\n      await dao.apagaTodos();\r\n      this._negociacoes.esvazia();\r\n      this._mensagem.texto = \"Negociações apagadas com sucesso!\";\r\n    } catch (err) {\r\n      this._mensagem.texto = err.message;\r\n    }\r\n  }\r\n}\r\n"]}